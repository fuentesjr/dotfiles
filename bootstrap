#!/bin/bash
# Run by codespaces after starting

exec > >(tee -i $HOME/dotfiles_install.log)
exec 2>&1
set -x

mv $HOME/.gitconfig $HOME/.gitconfig.stock
mv $HOME/.zshrc $HOME/.zshrc.stock
ln -s /workspaces/.codespaces/.persistedshare/dotfiles/ $HOME/dotfiles

sudo apt-get update -y
sudo apt-get -y install stow fish rustc exa htop fzf figlet

brew install neovim lazygit ack
nvim --headless +PlugInstall +qall

brew install --HEAD universal-ctags/universal-ctags/universal-ctags
echo "building ctags"
script/build-ctags > /dev/null 2>&1

echo "Installing rdm"
wget https://github.com/BlakeWilliams/remote-development-manager/releases/latest/download/rdm-linux-amd64
sudo mv rdm-linux-amd64 /usr/local/bin/rdm
sudo chmod +x /usr/local/bin/rdm
gh config set browser "rdm open"
alias open="rdm open"
alias xdg-open="rdm open"

# Stow dotfiles
echo 'Stowing dotfiles...'
stow --target=$HOME git tmux vim nvim
